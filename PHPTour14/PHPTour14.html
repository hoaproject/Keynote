<!DOCTYPE html>

<html>
<head>
  <title>Praspel, un langage de spÃ©cification par contrats (PHPTour'14, Lyon)</title>
  <meta http-equiv="content-type" content="text/html;       charset=utf-8" />
  <meta http-equiv="content-type" content="text/javascript; charset=utf-8" />
  <meta http-equiv="content-type" content="text/css;        charset=utf-8" />

  <link type="text/css" href="http://static.hoa-project.net/Css/Keynote.css" rel="stylesheet" />

  <style>
    .draw line {
        stroke: #000;
        stroke-width: 2;
    }

    .draw circle {
        fill: #000;
        stroke-width: 0;

    }

    .northğŸ“Œ {
        text-anchor: middle;
        dominant-baseline: central;
        transform: translate(0, 1em);
    }

    .north-eastğŸ“Œ {
        text-anchor: end;
        dominant-baseline: central;
        transform: translate(-.5em, 1em);
    }

    .eastğŸ“Œ {
        text-anchor: end;
        dominant-baseline: central;
        transform: translate(-.5em, 0);
    }

    .south-eastğŸ“Œ {
        text-anchor: end;
        dominant-baseline: auto;
        transform: translate(-.5em, -.5em);
    }

    .southğŸ“Œ {
        text-anchor: middle;
        dominant-baseline: auto;
        transform: translate(0, -.5em);
    }

    .south-westğŸ“Œ {
        text-anchor: start;
        dominant-baseline: auto;
        transform: translate(.5em, -.5em);
    }

    .westğŸ“Œ {
        text-anchor: start;
        dominant-baseline: central;
        transform: translate(.5em, 0);
    }

    .north-westğŸ“Œ {
        text-anchor: start;
        dominant-baseline: central;
        transform: translate(.5em, 1em);
    }
  </style>
</head>
<body>

<script src="http://static.hoa-project.net/Javascript/Hoa.js"></script>

<section>
  <h1>Praspel, un langage de spÃ©cification par contrats</h1>

  <div class="tcenter">
    <img src="http://afup.org/templates/phptourlyon2014/medias/images/logo.png"
         alt="Logo du PHPTour"
         width="300px"
         class="center" />
    <p class="break"><small><time datetime="2014-06-24">24 juin 2014</time></small></p>
  </div>
</section>

<section>
  <h1>Qui sommes-nousÂ ?</h1>

  <p>Ivan EnderlinÂ :</p>
  <ul>
    <li>doctorant en Informatique
        (<a href="http://disc.univ-fcomte.fr/">DISC</a>,
         <a href="http://www.inria.fr/">INRIA</a>)</li>
    <li><em lang="en">leader</em> et dÃ©veloppeur de
        <a href="http://hoa-project.net/">Hoa</a></li>
    <li>contributeur
        <a href="http://php.net/">PHP</a>,
        <a href="http://mozilla.org/">Mozilla</a>,
        <a href="http://debian.org/">Debian</a>,
        <a href="http://atoum.org/">atoum</a>â€¦ open-source</li>
    <li>expert invitÃ© au
        <a href="http://w3.org/">W3C</a> (HTML, CSS et WebApp)</li>
    <li><a href="https://twitter.com/hoaproject">@hoaproject</a>,
        <a href="irc://irc.freenode.net#hoaproject">#hoaproject</a></li>
  </ul>

  <p class="tcenter break">
    <math>
      <mrow>
        <mtext>ivan.enderlin@</mtext>
        <mo>{</mo>
        <mtable>
          <mtr>
            <mtd><mtext>hoa-project.net</mtext></mtd>
          </mtr>
          <mtr>
            <mtd><mtext>atoum.org</mtext></mtd>
          </mtr>
          <mtr>
            <mtd><mtext>inria.fr</mtext></mtd>
          </mtr>
        </mtable>
      </mrow>
    </math>
  </p>
</section>

<section>
  <h1>Qui sommes-nousÂ ?</h1>

  <p>Julien BianchiÂ :</p>
  <ul>
    <li>dÃ©veloppeur <a href="http://php.net/">PHP</a> &amp;
        <a href="http://resume.github.io/?jubianchi#mylanguages">â€¦</a></li>
    <li>contributeur <a href="http://atoum.org/">atoum</a></li>
    <li>QA <a href="https://twitter.com/PMSIpilot">@PMSIpilot</a></li>
    <li>campeur
        <a href="irc://irc.freenode.net#hoaproject">#hoaproject</a>,
        <a href="irc://irc.freenode.net##atoum">##atoum</a></li>
  </ul>

  <p class="tcenter break">
  <math>
    <mrow>
      <mtext>@jubianchi</mtext>
      <mo>{</mo>
      <mtable>
        <mtr>
          <mtd><mtext>twitter.com</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>github.com</mtext></mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
  <br />
  <math>
    <mrow>
      <mtext>julien.bianchi@</mtext>
      <mo>{</mo>
      <mtable>
        <mtr>
          <mtd><mtext>atoum.org</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>hoa-project.net</mtext></mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
  </p>
</section>

<section>
  <h1>DÃ©finitions</h1>

  <div class="incremental">
    <p><em lang="en">System Under Test</em> (<strong>SUT</strong>)Â : systÃ¨me qui
    sera exÃ©cutÃ©</p>
    <div class="break">
      <div class="fleft">
        <ul>
          <li data-item=" ">prÃ©ambule</li>
          <li data-item="+">donnÃ©es</li>
          <li data-item="+">oracle</li>
          <li data-item="="><strong>cas de test</strong></li>
        </ul>
      </div>
      <div class="fright" style="width: 75%">
        <ul>
          <li data-item=":">place le SUT dans un Ã©tat particulier</li>
          <li data-item=":"><strong>test</strong>, pour exÃ©cuter le SUT</li>
          <li data-item=":">Ã©tablit le verdict, est-ce que le produit de
          lâ€™exÃ©cution et lâ€™Ã©tat du SUT aprÃ¨s son exÃ©cution sont ceux attendus ou
          nonÂ ?</li>
        </ul>
      </div>
    </div>
    <p class="break clear">Valeurs du verdictÂ : <span class="ğŸ‘">succÃ¨s</span>,
                                                <span class="ğŸ‘">Ã©chec</span> ou
                                                inconclusif</p>
    <p class="break"><strong>Suite de test</strong>Â : ensemble de cas de tests</p>
  </div>
</section>

<section>
  <h1>Nature des tests</h1>

  <div class="schema">
    <svg width="700" height="400" viewBox="60 0 780 480" class="draw">

      <defs>
          <marker id="arrowHead"
                  viewBox="0 0 10 10" 
                  refX="1" refY="5"
                  markerWidth="6" 
                  markerHeight="6"
                  orient="auto">
              <path d="M 0 0 L 10 5 L 0 10 z" />
          </marker>
      </defs>

      <g class="incremental">
        <g>
          <line x1="375" y1="250" x2="650" y2="250"
                marker-end="url(#arrowHead)" />

          <text x="650" y="250" class="north-westğŸ“Œ">Support de</text>
          <text x="650" y="265" class="north-westğŸ“Œ">conception</text>

          <circle cx="465" cy="250" r="3" />
          <circle cx="565" cy="250" r="3" />

          <text x="465" y="235" class="southğŸ“Œ">BoÃ®te</text>
          <text x="465" y="250" class="southğŸ“Œ">noire</text>
          <text x="565" y="235" class="southğŸ“Œ">BoÃ®te</text>
          <text x="565" y="250" class="southğŸ“Œ">blanche</text>
        </g>

        <g>
          <line x1="375" y1="250" x2="375" y2="50"
                marker-end="url(#arrowHead)" />

          <text x="375" y="50" class="south-eastğŸ“Œ">Taille du systÃ¨me</text>

          <circle cx="375" cy="210" r="3" />
          <circle cx="375" cy="170" r="3" />
          <circle cx="375" cy="130" r="3" />
          <circle cx="375" cy="90"  r="3" />

          <text x="375" y="210" class="eastğŸ“Œ">Unitaire</text>
          <text x="375" y="170" class="eastğŸ“Œ">Composant</text>
          <text x="375" y="130" class="eastğŸ“Œ">IntÃ©gration</text>
          <text x="375" y="90"  class="eastğŸ“Œ">SystÃ¨me</text>
        </g>

        <g transform="rotate(45 375 250)">
          <line x1="375" y1="250" x2="375" y2="450"
                marker-end="url(#arrowHead)" />

          <text x="375" y="450" class="north-westğŸ“Œ">Type de test</text>

          <circle cx="375" cy="290" r="3" />
          <circle cx="375" cy="330" r="3" />
          <circle cx="375" cy="370" r="3" />
          <circle cx="375" cy="410" r="3" />

          <text x="375" y="290" class="westğŸ“Œ">Fonctionnel</text>
          <text x="375" y="330" class="westğŸ“Œ">Robustesse</text>
          <text x="375" y="370" class="westğŸ“Œ">Performance</text>
          <text x="375" y="410" class="westğŸ“Œ">UtilisabilitÃ©</text>
        </g>
      </g>
    </svg>

    <div class="incremental">
      <p>Nous faisons du test boÃ®te noire, unitaire et fonctionnel.</p>
    </div>
  </div>
</section>

<section>
  <h1><em lang="en">Design by Contract</em></h1>

  <div class="incremental">
    <div>
      <p>ContratÂ :</p>
      <ul>
        <li>inventÃ© par B. Meyer en 1992 dans le langage Eiffel</li>
        <li>dÃ©crit un modÃ¨le en utilisant des annotations</li>
        <li>exprime des contraintes formellesÂ : prÃ©conditions, postconditions et
        invariants</li>
      </ul>
    </div>
    <div>
      <ul>
        <li data-item="â€”"><em lang="en">caller</em>Â : Â«Â je m'engage Ã  satisfaire ta
            prÃ©conditionÂ Â»</li>
        <li data-item="â€”"><em lang="en">callee</em>Â : Â«Â je m'engage Ã  Ã©tablir ma
            postconditionÂ Â»</li>
        <li data-item="">invariants satisfaits avant et aprÃ¨s l'exÃ©cution du
            <em lang="en">callee</em></li>
      </ul>
    </div>

    <div id="design_by_contract" class="verbatim schema"></div>
  </div>

  <script>
  Hoa.Document.onReady(function ( ) {

      var paper      = Hoa.Graph(Hoa.$('#design_by_contract'), 800, 150);
      var grid       = paper.grid(0, 0, 800, 150, 5, 1);
      var invariant1 = grid.push(paper.rect(0, 0, 140, 80, 3, 'invariants'));
      var pre        = grid.push(paper.rect(0, 0, 140, 80, 3, 'prÃ©conditions'));
      var method     = grid.push(paper.circle(0, 0, 25));
      var _method    = paper.text(400, 30, 'mÃ©thode');
      var post       = grid.push(paper.rect(0, 0, 140, 80, 3, 'postconditions'));
      var invariant2 = grid.push(paper.rect(0, 0, 140, 80, 3, 'invariants'));

      paper.link.between(invariant1, pre);
      paper.link.between(pre, method);
      paper.link.between(method, post);
      paper.link.between(post, invariant2);
  });
  </script>
</section>

<section>
  <h1>Langages de contrats</h1>

  <p>Chaque Â«Â grandÂ Â» langage Ã  un langage de contratÂ :</p>
  <ul>
    <li><em lang="en">Java Modeling Language</em> (JML) pour Java</li>
    <li><em lang="en">ANSI/C Specification Language</em> (ACSL) pour C</li>
    <li><em lang="en">Spec#</em> pour C#</li>
    <li><em lang="en">JSConTest</em> pour Javascript</li>
  </ul>
  <p class="break incremental"><span>Pour PHPÂ ?</span> <span class="ğŸ‘">RienÂ !</span></p>
</section>

<section>
  <h1><em lang="en">Contract-based Testing</em></h1>

  <div class="incremental">
    <div>
      <p>PrincipeÂ :</p>
      <ul>
        <li>utilise les prÃ©conditions pour gÃ©nÃ©rer des donnÃ©es de tests</li>
        <li>utilise les postcondtions et invariants pour Ã©tablir le verdict du
            test Ã  l'exÃ©cution, grÃ¢ce Ã  un <em lang="en">Runtime Assertion
            Checker</em> (RAC)</li>
      </ul>
    </div>

    <div>
      <p class="break">ProblÃ¨mesÂ :</p>
      <ul>
        <li>contraintes souvent exprimÃ©es avec des formules logiques</li>
        <li>difficile de gÃ©nÃ©rer de donnÃ©es</li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Contributions</h1>

  <p>Faire du <em lang="en">contract-based testing</em> en PHP en 3Â Ã©tapesÂ :</p>
  <ol>
    <li>un (nouveau) langage de contratsÂ :
    <ul>
      <li>adapter Ã  PHP</li>
      <li>pragmatique</li>
      <li>facile Ã  utiliser pour le dÃ©veloppeur</li>
      <li>assemblant plusieurs mÃ©thodes de test</li>
    </ul>
    </li>
    <li>des gÃ©nÃ©rateurs de donnÃ©es, pour tous les types usuels</li>
    <li>gÃ©nÃ©rer automatiquement des suites de tests unitaires</li>
  </ol>
</section>

<section>
  <h1>Agenda</h1>

  <ol>
    <li>Praspel et les domaines rÃ©alistes</li>
    <li>GÃ©nÃ©ration automatique de donnÃ©es</li>
    <li>GÃ©nÃ©ration automatique de tests unitaires</li>
    <li>Extension <code>atoum/praspel-extension</code></li>
    <li>Conclusion</li>
  </ol>
</section>

<section class="chapter">
  <h1>1 <span>Praspel et les domainesÂ rÃ©alistes</span></h1>
</section>

<section>
  <h1>Vue gÃ©nÃ©rale</h1>

  <pre id="overview"><code class="language-php">class C {

    /**
     * @invariant I;
     */
    protected $a;

    /**
     * @requires P;
     * @behavior Î± {
     *     @description 'Apply the Î± process.';
     *     @requires P_Î±;
     *     @behavior Î² {
     *         @requires  P_Î±_Î²;
     *         @ensures   Q_Î±_Î²;
     *         @throwable T_Î±_Î²;
     *     }
     * }
     * @behavior Î³ {
     *     @requires P_Î³;
     *     â€¦
     * }
     * @default {
     *     @description 'Apply the fallback process.';
     *     @ensures   Q_D;
     *     @throwable T_D;
     * }
     */
     public function f ( ) { }
}</code></pre>
  <div class="incremental incremental-overlay">
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('4')">
       <code>@invariant</code> exprime un invariant</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('9,12,14,20')">
       <code>@requires</code> exprime une prÃ©condition</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('15,25')">
       <code>@ensures</code> exprime une postcondition normale</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('16,26')">
       <code>@throwable</code> exprime une postcondition exceptionnelleÂ ;
       de la forme <code>T_C with T_E</code></p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('10,19')">
       <code>@behavior</code> exprime un comportement</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('23')">
       <code>@default</code> exprime un comportement par dÃ©faut, avec une clause
       <code>@requires</code> implicite</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('11,24')">
       <code>@description</code> dÃ©crit informellement un comportement</p>
  </div>
</section>

<section>
  <h1>Expressions</h1>

  <p><code>P</code>, <code>Q</code> et <code>T_E</code> reprÃ©sente une
  expressionsÂ :</p>
  <ul>
    <li>une dÃ©claration</li>
    <li>un prÃ©dicat</li>
    <li>une qualification</li>
  </ul>
  <div class="incremental incremental-overlay">
    <div>
      <p>DÃ©clarationÂ :</p>
      <ul>
        <li>associe un ou plusieurs domaines rÃ©alistes Ã  une variable du SUT
        (arguments) ou du modÃ¨le (<code>let</code>)</li>
        <li>plusieurs = disjonction de domaines rÃ©alistes</li>
        <li><code>\result</code> reprÃ©sente le rÃ©sultat du SUT</li>
        <li><code>\old(<em>i</em>)</code> reprÃ©sente la valeur de
        <code><em>i</em></code> dans le prÃ©-Ã©tat (avant l'exÃ©cution du SUT)</li>
      </ul>
    </div>
    <div>
      <p>PrÃ©dicatÂ : </p>
      <ul>
        <li>toutes les constructions de Praspel supportent la
        <strong>validation</strong> et la <strong>gÃ©nÃ©ration</strong> maisâ€¦</li>
        <li>toutes les contraintes ne peuvent pas Ãªtre exprimÃ©es</li>
        <li><code>\pred(<code><em>p</em></code>)</code> oÃ¹
        <code><em>p</em></code> est du code PHP pur (en forme normale
        conjonctive, CNF)</li>
      </ul>
    </div>
    <div>
      <p>QualificationÂ :</p>
      <ul>
        <li>qualifier une donnÃ©e avec un adjectif</li>
        <li>Â«Â mot-clÃ©Â Â» reprÃ©sentant des constraintes usuelles</li>
        <li>facilite la vie, facile Ã  lire, Ã©vite les erreurs</li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Constructions</h1>
</section>

<section>
  <h1>Exemples</h1>
</section>

<section>
  <h1>Domaines rÃ©alistes</h1>
</section>

<section>
  <h1>Univers <math><msub><mi mathvariant="normal">U</mi><mtext>realdom</mtext></msub></math></h1>
</section>

<section class="chapter">
  <h1>2 <span>GÃ©nÃ©ration automatique de donnÃ©es</span></h1>
</section>

<section>
  <h1>GÃ©nÃ©ration standard</h1>
</section>

<section>
  <h1>GÃ©nÃ©ration de tableaux</h1>
</section>

<section>
  <h1>GÃ©nÃ©ration de chaÃ®nes de caractÃ¨res</h1>
</section>

<section>
  <h1>GÃ©nÃ©ration d'objets</h1>
</section>

<section class="chapter">
  <h1>3 <span>GÃ©nÃ©ration automatique de tests unitaires</span></h1>
</section>

<section>
  <h1>Objectifs de tests</h1>
</section>

<section>
  <h1>CritÃ¨re de couvertures sur les contrats</h1>
</section>

<section>
  <h1>GÃ©nÃ©ration de suites de tests atoum</h1>
</section>

<section class="chapter">
  <h1>4 <span>Extension<br /><small><code>atoum/praspel-extension</code></span></small></h1>
</section>

<section>
  <h1>Des nouveaux Â«Â <em lang="en">asserters</em>Â Â»</h1>
</section>

<section>
  <h1>GÃ©nÃ©ration de donnÃ©es</h1>
</section>

<section class="chapter">
  <h1>5 <span>Conclusion</span></small></h1>
</section>

<section>
  <h1>Outillage</h1>
</section>

<section>
  <h1>Quelques liens</h1>

  <ul>
    <li>thÃ¨seÂ : â€¦</li>
    <li>documentationÂ : â€¦</li>
    <li>extension atoumÂ : â€¦</li>
  </ul>
</section>

<section class="chapter">
  <h1>MerciÂ ! <span>â˜ºï¸</span></h1>

  <p class="tcenter">
    <a href="http://hoa-project.net/">hoa-project.net</a>
    <br />
    <a href="https://twitter.com/hoaproject">@hoaproject</a>
  </p>
</section>

<div id="progress-bar"></div>

<script src="http://static.hoa-project.net/Javascript/Keynote.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.hoa.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.plugin.line.js"></script>
<script src="http://static.hoa-project.net/Javascript/Hoa.Graph.js"></script>
<script src="http://static.hoa-project.net/Javascript/Hoa.Graph.style.js"></script>
<script>
  Hoa.namespace([HTMLElement], {

      guard: function ( ) {

          return true;
      },
      body : function ( element ) {

          return {

              highlightLines: function ( lines ) {

                  element.setAttribute('data-line', lines);
                  Prism.hooks.run(
                      'after-highlight',
                      {
                          element: element.querySelector('code')
                      }
                  );
              }
          };
      }
  });
</script>

</body>
</html>
